# 事务脚本处理事件

1、当发生某件事件的时候，执行某个动作。

2、当有人回复了用户的提问的时候，系统就向提问者的邮箱发送通知邮件。

void 保存答案（id,answer）

{

​	保存到数据库();

​	string email= 获取提问者邮箱（id）;

​	发送邮件（email，“你的问题被回答了”）；

}

# 问题1

代码会随着需求的增加而持续膨胀。比如增加功能就会添加一点代码。

![img](https://pics2.baidu.com/feed/d62a6059252dd42ae770c7d3245632b2c8eab8c6.jpeg?token=453f36f6cfdc6bf3363543168e46ae88)

# 问题二

代码可扩展性低。比如把发送邮件改成发送短信。

开闭原则：对扩展开放，对修改关闭。

# 问题三

容错性差。外部系统并不总是稳定的。



# 采用事件机制的伪代码

 void 保存答案（）

{

​	保存到数据库（id，amawer）；

​    发布事件（“source”，id，amswer）

}



[绑定事件（“source”）]

void 发送短信（）

{

 发送短信（id，“你的问题已被回复”）

}



[绑定事件（“source”）]

void 审核答案（）

{

......

​	if(违规){

 		发送事件（“内容待审核”，id，“审核”）

​	}

}



# 两种事件

1、DDD中的事件分为两种类型：领域事件（domain events）、集成事件（integration events）

2、领域事件：在同一个微服务内的聚合之间的事件传递。使用进程内的通信机制完成。

3、集成事件：跨微服务的事件传递。使用事件总线 （eventbus）实现。