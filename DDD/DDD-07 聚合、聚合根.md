# 聚合（Aggregate）

1、目的：高内聚，低耦合。有关系的实体紧密协作，而关系很弱的实体被隔离

2、把关系紧密的实体放到一个聚合中，每个聚合中有一个实体作为聚合根（Aggregate）所有对于聚合内对象的访问都通过聚合根来进行，外部对象只能持有聚合根的引用。

3、聚合根不仅仅是实体，还是所在聚合的管理者。



~~~mermaid
graph LR
A[发电机]--->B[导线]
B--->C[灯泡]
~~~



发电机和灯泡内部都是紧密结合，缺一不可

发电机和灯泡没有什么直接关系。

只要满足标准两边可以随意替换。

比如把发电机替换为电池，把灯泡替换为电视都可以正常工作





# 聚合根

聚合中有一个实体作为聚合根（Aggregate）所有对于聚合内对象的访问都通过聚合根来进行

# 聚合的意义

1、为什么聚合可以实现高内聚、低耦合。

2、聚合体现的是实现世界中整体和部分的关系，比如订单与订单明细。整体封装了对部分的操作，部分与整体有相同的生命周期。部分不会单独与外部系统单独交互，与外部系统的交互都由整体来负责。



# 聚合的划分很难

1、系统中很多实体都存在着不同程度的关系，这些关系到底是设计为聚合之间的关系还是聚合之内的关系是很难的。

2、聚合的判断标准：实体是否是整体和部分的关系，是否存在相同的生命周期。

3、订单与订单明细（分为一个聚合，订单明细外部只能通过订单操作）、用户与订单（分为两个聚合，订单还可能被其他外部系统使用）

# 聚合划分原则

1、尽量把聚合设计的小一点，一个聚合只包含一个聚合根和密不可分的的实体，实体中只包含最小数量的属性。

2、小聚合有助于微服务的拆分。
